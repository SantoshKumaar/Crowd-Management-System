import{r as n,j as e}from"./index-DJDvtjUH.js";import{a as k,A as C}from"./apiHelpers-gBmBPnov.js";const D=()=>{const[b,i]=n.useState([]),[y,h]=n.useState(!0),[p,U]=n.useState(""),[s,w]=n.useState(1),[l,d]=n.useState(1);n.useEffect(()=>{j()},[s]);const j=async()=>{var t,o;try{h(!0);const a=k({pageNumber:s,pageSize:10});console.log("payload:",a);const c=await C.getEntryExit(a),m=(c==null?void 0:c.data)||c;if(m){const g=m.records||[];if(console.log("CrowdEntries: Records found:",g.length),g.length===0){i([]),d(1);return}const u=g.map(r=>{console.log("CrowdEntries:",r);let f="--";if(r.dwellMinutes!==null&&r.dwellMinutes!==void 0){const E=Math.floor(r.dwellMinutes),T=Math.floor(r.dwellMinutes%1*60);f=`${String(E).padStart(2,"0")}:${String(T).padStart(2,"0")}`}const S=r.gender||r.sex||"Unknown";return{id:r.personId||Math.random().toString(),name:r.personName||"Unknown",gender:S,entryTime:r.entryLocal||(r.entryUtc?new Date(r.entryUtc).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"--"),exitTime:r.exitLocal||(r.exitUtc?new Date(r.exitUtc).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"--"),dwellTime:f,zoneName:r.zoneName,avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(r.personName||"Unknown")}&background=009688&color=fff&size=32`}});console.log("Transformed entries:",u),i(u),d(m.totalPages||1)}else i([]),d(1)}catch(a){((t=a.response)==null?void 0:t.status)===400&&(console.error("400 Bad Request - API expects different payload structure"),console.error("Request payload was:",{page:s,limit:10}),console.error("API error details:",(o=a.response)==null?void 0:o.data)),i(generateMockEntries()),d(5)}finally{h(!1)}},N=t=>!t||t==="--"?"--":t,v=t=>t.split(" ").map(o=>o[0]).join("").toUpperCase(),x=t=>{t>=1&&t<=l&&w(t)};return y?e.jsx("div",{className:"p-6 max-w-[1600px] mx-auto h-[calc(100vh-64px)] overflow-hidden flex flex-col",children:e.jsx("div",{className:"text-center py-10 text-lg text-gray-600",children:"Loading crowd entries..."})}):e.jsx("div",{className:"p-6 max-w-[1600px] mx-auto h-[calc(100vh-64px)] overflow-hidden flex flex-col",children:e.jsx("div",{className:"flex gap-6 flex-1 overflow-hidden",children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Overview"}),p&&e.jsx("div",{className:"text-center py-10 text-lg text-red-600 bg-red-50 rounded-lg mb-6 border border-red-200",children:p}),e.jsx("div",{className:"flex-1 overflow-auto bg-white rounded-lg shadow-[0_2px_4px_rgba(0,0,0,0.05)]",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left font-semibold text-gray-800 text-sm border-b-2 border-gray-200",children:"Name"}),e.jsx("th",{className:"p-4 text-left font-semibold text-gray-800 text-sm border-b-2 border-gray-200",children:"Sex"}),e.jsx("th",{className:"p-4 text-left font-semibold text-gray-800 text-sm border-b-2 border-gray-200",children:"Entry"}),e.jsx("th",{className:"p-4 text-left font-semibold text-gray-800 text-sm border-b-2 border-gray-200",children:"Exit"}),e.jsx("th",{className:"p-4 text-left font-semibold text-gray-800 text-sm border-b-2 border-gray-200",children:"Dwell Time"})]})}),e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-10 text-gray-400",children:"No entries found"})}):b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-4 border-b border-gray-100 text-gray-600 text-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center text-xs font-semibold flex-shrink-0",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{children:v(t.name)})}),e.jsx("span",{children:t.name})]})}),e.jsx("td",{className:"p-4 border-b border-gray-100 text-gray-600 text-sm",children:t.gender}),e.jsx("td",{className:"p-4 border-b border-gray-100 text-gray-600 text-sm",children:t.entryTime}),e.jsx("td",{className:"p-4 border-b border-gray-100 text-gray-600 text-sm",children:t.exitTime||"--"}),e.jsx("td",{className:"p-4 border-b border-gray-100 text-gray-600 text-sm",children:N(t.dwellTime)})]},t.id))})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 p-4",children:[e.jsx("button",{className:"px-3 py-2 border border-gray-300 bg-white rounded text-sm text-gray-600 transition-all min-w-[36px] hover:bg-gray-100 hover:border-teal-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>x(s-1),disabled:s===1,children:"<"}),Array.from({length:Math.min(l,5)},(t,o)=>{let a;return l<=5||s<=3?a=o+1:s>=l-2?a=l-4+o:a=s-2+o,e.jsx("button",{className:`px-3 py-2 border rounded text-sm transition-all min-w-[36px] ${s===a?"bg-teal-500 text-white border-teal-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-100 hover:border-teal-500"}`,onClick:()=>x(a),children:a},a)}),l>5&&s<l-2&&e.jsx("span",{className:"px-2 py-2 text-gray-400",children:"..."}),l>5&&e.jsx("button",{className:`px-3 py-2 border rounded text-sm transition-all min-w-[36px] ${s===l?"bg-teal-500 text-white border-teal-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-100 hover:border-teal-500"}`,onClick:()=>x(l),children:l}),e.jsx("button",{className:"px-3 py-2 border border-gray-300 bg-white rounded text-sm text-gray-600 transition-all min-w-[36px] hover:bg-gray-100 hover:border-teal-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>x(s+1),disabled:s===l,children:">"})]})]})})})};export{D as default};
